VERBOSE=off
MAILDIR=$HOME/.maildir/
PMDIR=$HOME/.procmail
LOGFILE=$PMDIR/procmail.log


INCLUDERC=$PMDIR/trash.rc


:0 c
* ^.*$
| attachment-parser 

# Call hmailfilter program to determine 
# in which folder does belong the mail
DEST=`/usr/local/bin/hmailclassifier`

# Unified view for mobile
# A cronjob is responsible to clean the folder periodically
# doveadm expunge -u erebe mailbox TheOne savedbefore 3d
# Avoid mailling mails and blacklisted ones !
:0 c
* ! DEST ?? (\.Mailing|/null|\.Spam)
./


:0 
* DEST ?? (\.Mailing)
{
    SUBJECT=`formail -XSubject: | sed 's/\(re: \)\?[ ]*\[[-_a-Z]\+\][ ]*/ \1/I'`
    :0 fhw
    | formail -i "$SUBJECT"
}
    


# Actually store the mail in the 
# folder determined by hmailfilter
:0:
* .
$DEST


# Should not happen, but in case
# default everything to the mailbox
:0:
* .*$
$MAILDIR

